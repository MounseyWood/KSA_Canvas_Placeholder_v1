<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Text Camouflage</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js" integrity="sha512-ymgUftodXDCZ5tIW7Vn7Ixq4xDdfbFa9ztBNHsGAreJxoNZ8KiYgniG6sc0IkcmXkn6n/9+pQ8uiw2fv3DW4D+g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            background-color: #fff200;
            overflow: hidden;
        }
        
        .text-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 10px;
            box-sizing: border-box;
            line-height: 1.2;
        }
        
        .word {
            display: inline-block;
            margin-right: 5px;
            color: #000000;
            cursor: pointer;
            transition: color 0.2s, font-weight 0.2s;
        }
        
        .word:hover {
            color: #ffffff;
            font-weight: bold;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000000;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <div class="text-layer" id="textLayer">
            <div class="loading">Loading words...<br><span id="loadingStatus" style="font-size: 14px; font-weight: normal;"></span></div>
        </div>
    </div>

    <script>
        // Default words to use if CSV is empty or not available
        const defaultWords = [
            "Fashion", "Style", "Design", "Trend", "Collection", "Luxury", "Vogue", "Apparel", 
            "Couture", "Runway", "Ensemble", "Editorial", "Silhouette", "Bespoke", "Elegance", 
            "Fabric", "Textile", "Pattern", "Garment", "Accessory", "Tailor", "Aesthetic", 
            "Iconic", "Chic", "Sophisticated", "Contemporary", "Minimal", "Maximalist", 
            "Vintage", "Retro", "Sustainable", "Artisanal", "Avant-garde", "Eclectic", 
            "Timeless", "Season", "Palette", "Denim", "Leather", "Cotton", "Silk", "Wool", 
            "Cashmere", "Linen", "Satin", "Velvet", "Knit", "Embroidery", "Print",
            "Texture", "Drape", "Stitch", "Seam", "Hem", "Pleats", "Ruffle", "Collar",
            "Sleeve", "Cuff", "Button", "Zipper", "Tailored", "Oversized", "Fitted", 
            "Structured", "Fluid", "Monochrome", "Colorful", "Bold", "Subtle", "Classic",
            "Trendy", "Edgy", "Refined", "Organic", "Geometric", "Abstract", "Florals",
            "Stripes", "Check", "Plaid", "Houndstooth", "Herringbone", "Modern", "Traditional",
            "Innovative", "Craftsmanship", "Technique", "Detail", "Proportion", "Balance", 
            "Layering", "Styling", "Coordination", "Visual", "Aesthetic", "Creative"
        ];
        
        // Array to store words from CSV
        let words = [];
        let wordsLoaded = false;

        // Function to load words from CSV file
        function loadWordsFromCSV() {
            // Try different possible paths to the CSV file
            const possiblePaths = [
                'words.csv',           // Same directory
                './words.csv',         // Explicit current directory
                '/words.csv',          // Root directory
                '../words.csv',        // Parent directory
                'assets/words.csv',    // Common subdirectory
                window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/')) + '/words.csv' // Dynamic path based on current page
            ];

            // Add the absolute URL based on current page location
            const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
            possiblePaths.push(baseUrl + 'words.csv');

            console.log("Attempting to load CSV from these locations:", possiblePaths);
            
            // Function to try loading from the next path
            function tryNextPath(index) {
                if (index >= possiblePaths.length) {
                    console.error("Failed to load CSV from all possible paths");
                    // Use default words if CSV loading fails from all locations
                    words = defaultWords;
                    wordsLoaded = true;
                    createTextPattern();
                    addInteractivity();
                    return;
                }

                const path = possiblePaths[index];
                console.log(`Attempting to load from: ${path}`);
                
                updateLoadingStatus(`Trying path: ${path}`);
                fetch(path)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`CSV file not found at ${path}`);
                        }
                        updateLoadingStatus(`Found file at: ${path}`);
                        return response.text();
                    })
                    .then(csvData => {
                        console.log(`Successfully fetched CSV from ${path}`);
                        
                        // Parse CSV data using PapaParse
                        let results;
                        try {
                            if (typeof Papa === 'undefined') {
                                throw new Error("Papa Parse is not available");
                            }
                            results = Papa.parse(csvData, {
                                header: true,
                                skipEmptyLines: true
                            });
                        } catch (parseError) {
                            console.error("Error parsing CSV:", parseError);
                            // If we can't parse, just use the raw text and split by lines
                            const lines = csvData.split(/\r?\n/).filter(line => line.trim() !== '');
                            if (lines.length > 1) {
                                // Assume first line is header, use rest as words
                                words = lines.slice(1).map(line => line.trim());
                                console.log(`Manually parsed ${words.length} words from CSV`);
                                wordsLoaded = true;
                                createTextPattern();
                                addInteractivity();
                                return;
                            } else {
                                throw new Error("CSV file format unrecognized");
                            }
                        }
                        
                        // Check if we have any data
                        if (results.data && results.data.length > 0) {
                            // Try to find a column named 'word' or the first column
                            words = results.data.map(row => {
                                // If there's a column named 'word', use that
                                if (row.word) return row.word;
                                // If there's a column named 'Word', use that
                                if (row.Word) return row.Word;
                                // Check for empty CSV with just headers but no data
                                if (Object.values(row)[0] === "") return null;
                                // Otherwise use the first value
                                return Object.values(row)[0];
                            }).filter(word => word && word.trim() !== '');
                        }
                        
                        // If no words were found, use our defaults
                        if (words.length === 0) {
                            console.warn("CSV file is empty. Using default words.");
                            words = defaultWords;
                        } else {
                            console.log(`Successfully loaded ${words.length} words from CSV`);
                        }
                        
                        wordsLoaded = true;
                        
                        // Now create the text pattern
                        createTextPattern();
                        addInteractivity();
                    })
                    .catch(error => {
                        console.error(`Error loading CSV from ${path}:`, error);
                        // Try the next path
                        tryNextPath(index + 1);
                    });
            }
            
            // Add status updates
            function updateLoadingStatus(message) {
                const statusElement = document.getElementById('loadingStatus');
                if (statusElement) {
                    statusElement.textContent = message;
                }
            }
            
            // Start trying paths
            updateLoadingStatus("Searching for words.csv file...");
            tryNextPath(0);
        }

        // Function to generate random words
        function getRandomWord() {
            return words[Math.floor(Math.random() * words.length)];
        }

        // Function to get random font weight
        function getRandomWeight() {
            const weights = [300, 400, 500, 600, 700];
            return weights[Math.floor(Math.random() * weights.length)];
        }

        // Function to calculate word density based on screen size
        function calculateWordDensity() {
            // This approximates how many words should be generated to fill the screen
            // We adjust density based on screen size to ensure proper coverage
            const screenArea = window.innerWidth * window.innerHeight;
            
            // Average word takes up roughly 2000 square pixels (variable with font size)
            // We add 20% more words to ensure proper coverage with variations
            return Math.ceil((screenArea / 1000) * 1.2);
        }

        // Function to create text pattern
        function createTextPattern() {
            const textLayer = document.getElementById('textLayer');
            let content = '';
            
            // Generate enough words to fill the screen based on calculated density
            const wordCount = calculateWordDensity();
            
            // If we somehow have no words (should never happen due to defaults), use placeholders
            if (!words || words.length === 0) {
                console.error("No words available for pattern creation");
                words = ["Word", "Text", "Content"];
            }
            
            // Create the text pattern
            for (let i = 0; i < wordCount; i++) {
                content += `<span class="word" style="font-weight: ${getRandomWeight()}">${getRandomWord()}</span>`;
            }
            
            textLayer.innerHTML = content;
        }

        // Add interactivity
        function addInteractivity() {
            const words = document.querySelectorAll('.word');
            
            words.forEach(word => {
                word.addEventListener('mouseover', () => {
                    // Random chance of triggering nearby words for a "ripple" effect
                    if (Math.random() < 0.3) {
                        const nearbyWords = Array.from(words).filter(() => Math.random() < 0.05);
                        nearbyWords.forEach(nearby => {
                            nearby.style.color = '#ffffff';
                            setTimeout(() => {
                                nearby.style.color = '#000000';
                            }, 500 + Math.random() * 1000);
                        });
                    }
                });
                
                word.addEventListener('click', () => {
                    // Create a ripple effect on click
                    const rippleEffect = () => {
                        const nearbyWords = Array.from(words).filter(() => Math.random() < 0.1);
                        nearbyWords.forEach(nearby => {
                            nearby.style.color = '#ffffff';
                            setTimeout(() => {
                                nearby.style.color = '#000000';
                            }, 200 + Math.random() * 800);
                        });
                    };
                    
                    // Create multiple ripples
                    for (let i = 0; i < 5; i++) {
                        setTimeout(rippleEffect, i * 100);
                    }
                });
            });
            
            // Add mouse movement effect
            document.addEventListener('mousemove', (e) => {
                const x = e.clientX;
                const y = e.clientY;
                
                // Find words near the cursor
                words.forEach(word => {
                    const rect = word.getBoundingClientRect();
                    const wordX = rect.left + rect.width / 2;
                    const wordY = rect.top + rect.height / 2;
                    
                    const distance = Math.sqrt(Math.pow(x - wordX, 2) + Math.pow(y - wordY, 2));
                    
                    if (distance < 100) {
                        const intensity = 1 - distance / 100;
                        word.style.fontWeight = Math.floor(400 + intensity * 300);
                    }
                });
            });
        }

        // Handle window resize
        function handleResize() {
            if (wordsLoaded) {
                createTextPattern();
                addInteractivity();
            }
        }

        // Check if Papa Parse is loaded
        function checkPapaParseLoaded() {
            if (typeof Papa === 'undefined') {
                console.error("Papa Parse library not loaded. Attempting to load it manually.");
                const script = document.createElement('script');
                script.src = "https://cdnjs.cloudflare.com/ajax/libs/papaparse/5.3.0/papaparse.min.js";
                script.integrity = "sha512-ymgUftodXDCZ5tIW7Vn7Ixq4xDdfbFa9ztBNHsGReJxoNZ8KiYgniG6sc0IkcmXkn6n/9+pQ8uiw2fv3DW4D+g==";
                script.crossOrigin = "anonymous";
                script.referrerPolicy = "no-referrer";
                script.onload = function() {
                    console.log("Papa Parse loaded manually");
                    loadWordsFromCSV();
                };
                script.onerror = function() {
                    console.error("Failed to load Papa Parse. Using default words.");
                    words = defaultWords;
                    wordsLoaded = true;
                    createTextPattern();
                    addInteractivity();
                };
                document.head.appendChild(script);
                return false;
            }
            return true;
        }

        // Function to proceed with initialization, with CSV parsing fallback
        function initializeWithoutPapaParse() {
            console.log("Initializing without PapaParse - using hard-coded words");
            // Use our default words since we can't parse CSV
            words = defaultWords;
            wordsLoaded = true;
            createTextPattern();
            addInteractivity();
        }

        // Initialize the pattern
        window.onload = function() {
            updateLoadingStatus("Checking if CSV parser is loaded...");
            
            // First check if Papa Parse is loaded
            if (!checkPapaParseLoaded()) {
                console.log("Waiting for Papa Parse to load");
                // The callback in checkPapaParseLoaded will handle initialization
                return;
            }
            
            // Load words from CSV first, then create the pattern
            loadWordsFromCSV();
            
            // Add window resize handler with debounce for better performance
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(handleResize, 250);
            });
        };
    </script>
</body>
</html>
